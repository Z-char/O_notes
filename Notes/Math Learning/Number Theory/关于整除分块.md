以前呢，整除分块这件事就是对着证明看一遍每一步过程理解了就行了，所以有些不求甚解啊，没太明白为什么这么做。于是呢，今天遇到了上取整的问题，我们来自己研究一下。
求：
$$
\sum\limits_{i=1}^{n} \left\lceil\frac{n}{i}\right\rceil
$$
众所周知，$\left\lceil\frac{n}{i}\right\rceil$ 只有 $\sqrt n$ 个不同的值，证明是 ~~显然的~~，确实是显然的，考虑 $i$ 取 $1$ 到 $\sqrt n$，只会提供 $\sqrt n$ 个不同解，当 $i \gt \sqrt n$ 时，这个值已经是 $\sqrt n$ 了，于是也最多只有 $\sqrt n$ 个。
那么，既然只有 $O(\sqrt n)$ 级别的值，我们如果要暴力扫过去求也太不雅观了，考虑能不能把这些段求出来，这样拿段值乘以长度就是一段的答案。

先拿个什么东西手模一下吧，取 $n=11$。

| 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 11  | 6   | 4   | 3   | 3   | 2   | 2   | 2   | 2   | 2   | 1   |
因为是连续的嘛，于是我们自然可以考虑维护一组 $(l, r, v)$ 表示当前维护的是 $(l, r)$ 区间且答案为 $v$。
我们观察一下，发现 $\left\lceil\frac{11}{2}\right\rceil=6$，并且 $\left\lceil\frac{11}{3}\right\rceil=4$，欸，好像有 $\left\lceil\frac{n}{v}\right\rceil=l$。
假设我们真的有这个定理，那么做法就很显然了，先维护最后一段，每次取 $l-1$ 就是上一段的 $r$，然后算出 $v$ 之后就可以知道 $l$，就做完了。
那么真的有这个定理吗？

### Pf.
令 $n = w_{1} r - R_{1},0\le R_{1}\lt r$，那么就有 $\left\lceil\frac{n}{r}\right\rceil=w_{1}$。
现在我们考虑 $\left\lceil\frac{n}{w_{1}}\right\rceil$，由于原来的分解已经出现了 $w_{1}$，而且和原来的 $r$ 有关联，我们自然想到设 $R_{1} = w_{2} w_{1} + R_{2}, 0 \le R_{2} \lt w_{1}$，那么就有 $n = (r - w_{2}) w_{1} - R_{2}, 0 \le R_{2} \lt w_{1}$，自然就有 $\left\lceil\frac{n}{w_{1}}\right\rceil=r-w_{2}$。
要证明 $r - w_{2}$ 是 $l$，则需要证明 $\left\lceil\frac{n}{r - w_{2}}\right\rceil=v=w_{1}$，且 $l-1$ 不会得到 $w_{1}$。
注意到 $n = (r - w_{2}) w_{1} - R_{2}$，如果能说明 $R_{2} \lt r-w_{2}$，那么就有我们需要证明的第一个等式了，考虑 $R_{1}\lt r$，于是有 $w_{2}w_{1}+R_{2} \lt r \Leftrightarrow R_{2} \lt r - w_{1}w_{2}$，显然 $w_{1} \ge 1$，则 $R_{2} \lt r - w_{2}$，故我们求出来的一定落在 $(l, r)$ 区间内。
至于第二个 $l-1$ 不会得到 $w_{1}$ 是比较浅显的，只需要进一步重写 $n$ 即可，读者自证不难。


